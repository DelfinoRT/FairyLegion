<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeDuel</title>
    <link rel="stylesheet" href="PokeDuel-Style.css">
</head>
<body>
    <div class="top-title-area">
        <h1 class="game-title">PokeDuel</h1>
        <p class="game-credits">by Fairy Legion</p>
    </div>

    <header>
        <div class="game-header">
            <div class="score-group">
                <div class="main-score-display">
                    Victorias: <strong id="wins-display">0</strong>
                </div>
                <div class="high-score-display">
                    Tokens: <strong id="token-display">0</strong>
                </div>
            </div>
            <div class="header-controls">
                <button id="gymChallengeBtn" class="gym-alert-btn hidden">üèÜ ¬°DESAF√çO DISPONIBLE! üèÜ</button>
                <button class="map-theme-btn" id="startGameBtn">Comenzar Juego</button>
                <button id="profileBtn" class="map-theme-btn" style="background: #6f42c1;">Perfil</button>
                <button id="rulesBtn" class="map-theme-btn" style="background: #17a2b8;">Reglas</button>
                <button id="resetDataBtn" class="reset-btn">Borrar Datos</button>
            </div>
            <span id="current-status">ESPERANDO</span>
        </div>
    </header>

    <main>
        <div id="main-message-panel" class="main-message-panel">
            <h2>Bienvenido a la Arena</h2>
            <p id="main-message-text">Presiona "Comenzar Juego" para iniciar el Draft 3 vs 3.</p>
            <p class="note">Gana 5 duelos para un Shiny Token. Gana 10 para retar a un L√≠der de Gimnasio.</p>
        </div>

        <!-- Recent Duels Panel -->
        <aside id="recent-duels-panel" class="recent-duels">
            <h3>√öltimos Duelo(s)</h3>
            <div id="recent-duels-list" class="recent-duels-list">
                <!-- JS will populate last 3 duel cards -->
            </div>
        </aside>

        <section id="selection-stage" class="game-stage hidden">
            <div class="stage-header">
                <h2>Fase de Selecci√≥n</h2>
                <button class="open-duel" onclick="window.location.href='/PokeDuel.html'">‚¨ÖÔ∏è Regresar</button>
                <p id="selection-instruction">Turno: <span id="turn-indicator">Jugador</span></p>
            </div>
            <div class="draft-preview">
                <div class="team-box">
                    <h4>Tu Equipo</h4>
                    <div id="player-team-preview" class="mini-team-row player-preview-interactive"></div>
                </div>
                <div class="team-box">
                    <h4>Equipo Rival</h4>
                    <div id="machine-team-preview" class="mini-team-row"></div>
                </div>
            </div>
            <br>
            <button id="confirmTeamBtn" class="action-btn" disabled>Confirmar Equipo</button>
            <br><br>
            <div id="shiny-selector-area" class="shiny-controls hidden">
                <p>Tienes <strong id="shiny-tokens-available">0</strong> Token(s). Haz clic en tus Pok√©mon para hacerlos Shiny.</p>
            </div>
            <div id="type-filters" class="type-filters"></div>
            <div id="selection-grid" class="selection-grid"></div>
        </section>

        <section id="tm-stage" class="game-stage hidden">
            <h2>Configuraci√≥n de Movimientos</h2>
            <button class="open-duel" onclick="window.location.href='/PokeDuel.html'">‚¨ÖÔ∏è Regresar</button>
            <br><br>
            <div id="tm-selection-container"></div>
            <div class="tm-controls">
                <button id="goToStarterBtn" class="action-btn" disabled>Siguiente: Elegir L√≠der</button>
            </div>
        </section>

        <section id="starter-stage" class="game-stage hidden">
            <h2>Elige tu Pok√©mon Inicial</h2>
            <div id="starter-selection-grid" class="starter-grid"></div>
        </section>

        <section id="duel-stage" class="game-stage hidden">
            <div class="duel-layout">
                <div class="party-sidebar player-party-sidebar">
                    <div class="sidebar-header">
                        <h4>Tu Equipo</h4>
                        <span class="swap-badge">Cambios: <span id="player-swaps-left">2</span>/2</span>
                    </div>
                    <div id="player-party-list" class="party-list"></div>
                </div>
                <div class="battle-center">
                    <div id="duel-container" class="duel-container">
                        <div class="battle-side player-side">
                            <div class="sprite-area"><img id="player-sprite" class="battle-sprite-img" src=""></div>
                            <div class="pokemon-stats">
                                <h3 id="player-name">Tu Pokemon</h3>
                                <div class="hp-bar-container"><div id="player-hp-bar" class="hp-bar"></div></div>
                                <p>HP: <span id="player-hp-text">100/100</span></p>
                                <div id="player-types" class="type-badges-container"></div>
                            </div>
                        </div>
                        <div class="log-wrapper"><div id="battle-log" class="battle-log"></div></div>
                        <div class="battle-side foe-side">
                            <div class="sprite-area"><img id="foe-sprite" class="battle-sprite-img" src=""></div>
                            <div class="pokemon-stats">
                                <h3 id="foe-name">Rival</h3>
                                <div class="hp-bar-container"><div id="foe-hp-bar" class="hp-bar"></div></div>
                                <p>HP: <span id="foe-hp-text">100/100</span></p>
                                <div id="foe-types" class="type-badges-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="battle-controls-wrapper" id="battle-controls-wrapper">
                        <h4 id="control-label">Elige tu ataque:</h4>
                        <div id="battle-controls" class="move-grid"></div>
                    </div>
                </div>
                <div class="party-sidebar machine-party-sidebar">
                    <div class="sidebar-header">
                        <h4>Rival</h4>
                        <span class="swap-badge">Cambios: <span id="machine-swaps-left">2</span>/2</span>
                    </div>
                    <div id="machine-party-list" class="party-list"></div>
                </div>
            </div>
        </section>
        
        <section id="results-stage" class="game-stage hidden">
            <h2 id="result-title">Resultado</h2>
            <p id="duel-result-text"></p>
            <button id="restartBtn" class="action-btn">Volver al Men√∫</button>
        </section>
    </main>

    <div id="profileModal" class="modal hidden">
        <div class="modal-content profile-content">
            <span class="close-modal" id="closeProfileBtn">&times;</span>
            <h2>Ficha de Entrenador</h2>
            <div class="trainer-header">
                <label for="trainer-name-input" style="font-weight:700; margin-right:8px;">Entrenador:</label>
                <span id="trainer-name-display" style="font-weight:700; color:var(--secondary);">--</span>
                <button id="trainer-edit-btn" class="action-btn" style="margin-left:12px; padding:6px 10px; font-size:0.85rem;">Editar</button>
                <div id="trainer-edit-area" style="display:none; margin-top:8px;">
                    <input id="trainer-name-input" type="text" maxlength="20" placeholder="Nombre del entrenador (m√°x 20)" style="padding:6px; width:220px; margin-right:6px;">
                    <button id="trainer-save-btn" class="action-btn" style="padding:6px 10px; font-size:0.85rem;">Guardar</button>
                    <button id="trainer-cancel-btn" class="reset-btn" style="padding:6px 10px; font-size:0.85rem; margin-left:6px;">Cancelar</button>
                </div>
            </div>

            <div class="profile-stats">
                <div class="stat-box"><h3>Victorias</h3><span id="profile-wins">0</span></div>
                <div class="stat-box"><h3>Winrate</h3><span id="profile-winrate">0%</span></div>
                <div class="stat-box"><h3>Tokens</h3><span id="profile-tokens">0</span></div>
                <div class="stat-box"><h3>Medallas</h3><span id="profile-badges-count">0</span></div>
            </div>

            <div class="stats-grid-container">
                <div class="stats-column">
                    <h3>üî• Top Pok√©mon</h3>
                    <ul id="top-pokemon-list" class="stats-list"></ul>
                </div>
                <div class="stats-column">
                    <h3>‚öîÔ∏è Top Movimientos</h3>
                    <ul id="top-moves-list" class="stats-list"></ul>
                </div>
                <div class="stats-column">
                    <h3>üõ°Ô∏è Tipos Favoritos</h3>
                    <ul id="top-types-list" class="stats-list"></ul>
                </div>
            </div>

            <hr>
            <h3>Colecci√≥n de Medallas</h3>
            <div id="badge-collection-container"></div>
        </div>
    </div>

    <div id="gymModal" class="modal hidden">
        <div class="modal-content">
            <h2>¬°Desaf√≠o de Gimnasio!</h2>
            <p>Elige una regi√≥n para desafiar a un L√≠der.</p>
            <div id="region-selector" class="region-grid"></div>
            <div id="leader-selector" class="leader-list hidden">
                <button id="backToRegions" class="action-btn" style="background:#777; margin-bottom:10px;">&larr; Volver</button>
                <div id="leader-grid" class="leader-grid"></div>
            </div>
        </div>
    </div>

    <!-- RULES MODAL -->
    <div id="rulesModal" class="modal hidden">
        <div class="modal-content">
            <h2>üìú Reglas</h2>
            <div class="rules-grid">
                <div class="rule-item">
                    <h3>3Ô∏è‚É£ Draft 3 vs 3:</h3>
                    <p>Selecci√≥n <strong>alternada</strong> de Pok√©mon (T√∫ eliges uno, la m√°quina otro) hasta tener 3 cada uno.</p>
                </div>
                <div class="rule-item">
                    <h3>‚ú® Sistema Shiny</h3>
                    <p>Usa tus Tokens en la selecci√≥n. Los Shiny hacen <strong>+20% de da√±o</strong>.</p>
                    <p>Ganas 1 Token por cada 5 victorias.</p>
                </div>
                <div class="rule-item">
                    <h3>‚öîÔ∏è Batalla por turnos cl√°sica</h3>
                    <p>Efectividad: El da√±o se calcula seg√∫n los tipos (Fuego vence a Planta, Agua vence a Fuego, etc.).</p>
                    <p>C√°lculo de Da√±o: Base del movimiento + Aleatoriedad + Multiplicador de Tipo + Bono Shiny (si aplica).</p>
                </div>
                <div class="rule-item">
                    <h3>üîÑ Mec√°nica de Cambios (Swaps)</h3>
                    <p>Cambios T√°cticos: Tienes un l√≠mite de 2 cambios manuales por partida para salvar a un Pok√©mon o ganar ventaja de tipo.</p>
                    <p>Cambio Forzado: Si tu Pok√©mon se debilita, debes elegir otro (esto no gasta tus cambios t√°cticos).</p>
                </div>
                <div class="rule-item">
                    <h3>üèÜ Gimnasios</h3>
                    <p>Cada 10 victorias desbloqueas un L√≠der</p>
                    <p>Obtienes una medalla tras derrotar a cada uno de los l√≠deres.</p>
                </div>
                <div class="rule-item">
                    <h3>üíæ Progreso</h3>
                    <p>Las victorias y los Tokens se guardan autom√°ticamente en tu navegador (LocalStorage).</p>
                    <p>Puedes elegir borrar los datos guardados y comenzar desde cero en cualquier momento.</p>
                </div>
            </div>
            <button id="closeRulesBtn" class="action-btn">Entendido</button>
        </div>
    </div>

    <footer>
        <p>¬© PokeDuel by FairyLegion</p>
    </footer>

    <script src="PokeDuel-Script.js"></script>
</body>
</html>